:js
:llir
:cpp
:intl

//│ 
//│ Interpreted:
//│ undefined
:sllir
fun add(x) = y => x + y
fun add_curried(x)(y) = x + y
add(1)(2)
//│ = 3
//│ LLIR:
//│   class Lambda_lambda(lam_arg0) extends Callable {
//│     def apply1(y) =
//│       let x = +(lam_arg0,y) in
//│       x
//│   }
//│   class Lambda(lam_arg0) extends Callable {
//│     def apply1(y1) =
//│       let x1 = +(lam_arg01,y1) in
//│       x1
//│   }
//│   def add(x2) =
//│     let x3 = Lambda_lambda(x2) in
//│     x3
//│   def add_curried(x4) =
//│     let x5 = Lambda(x4) in
//│     x5
//│   def entry() =
//│     let* (x6) = add(1) in
//│     let x7 = Callable.apply1(x6,2) in
//│     x7
//│   entry = entry
//│ 
//│ Interpreted:
//│ 3

fun add4(a, b) = (c, d) => a + b + c + d
fun add4_curried(a, b)(c, d) = a + b + c + d
add4(1, 2)(3, 4)
//│ = 10
//│ 
//│ Interpreted:
//│ 10

fun add(a, b) = a + b
fun dummy() = add
dummy()(1, 2)
//│ = 3
//│ 
//│ Interpreted:
//│ 3

abstract class List[out T]: Cons[T] | Nil
data class (::) Cons[out T](head: T, tail: List[T]) extends List[T]
object Nil extends List
fun map(f, l) =
  if l is
    Cons(h, t) then Cons(f(h), map(f, t))
    Nil then Nil
fun inc(x) = x + 1
fun main() =
  map(x => inc(x), 1 :: 2 :: Nil)
  map(inc, 3 :: 4 :: Nil)
main()
//│ = Cons(4, Cons(5, Nil))
//│ 
//│ Interpreted:
//│ Cons(4,Cons(5,Nil()))

abstract class List[out T]: Cons[T] | Nil
data class (::) Cons[out T](head: T, tail: List[T]) extends List[T]
object Nil extends List
fun not(c) = if c then false else true
fun filter(f, ls) = if ls is
  Nil then Nil
  h :: t and
    f(h) then h :: filter(f, t)
    else filter(f, t)
fun nubBy(eq, ls) = if ls is
  Nil then Nil
  h :: t then h :: nubBy(eq, filter(y => not(eq(h, y)), t))
nubBy((x, y) => x == y, 1 :: 2 :: 3 :: 3 :: Nil)
//│ = Cons(1, Cons(2, Cons(3, Nil)))
//│ 
//│ Interpreted:
//│ Cons(1,Cons(2,Cons(3,Nil())))

:intl
fun f(x) =
  fun self_rec(x) =
    if x == 0 then 0
    else x + self_rec(x - 1)
  self_rec(x)
f(3)
//│ = 6
//│ 
//│ Interpreted:
//│ 6

fun f(x) =
  fun even(x) =
    fun odd(x) =
      if x == 0 then true
      else if x == 1 then false
      else even(x - 1)
    if x == 0 then true
    else if x == 1 then false
    else odd(x - 1)
  even(x)
f(3)
//│ = false
//│ 
//│ Interpreted:
//│ false
