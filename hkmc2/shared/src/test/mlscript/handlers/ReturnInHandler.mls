:js
:effectHandlers


abstract class Effect with
  fun f(): ()

// `return` within handle blocks is implemented as a non-local return
fun f() =
  handle h = Effect with
    fun foo()(r) =
      let m = r(())
      print("Bye!") // This never executes because `r` returns from `f`
      m
  h.foo()
  return 3 // Note: changing this to just `3` leads to `print("Bye!")` executing
f()
//│ = 3

fun f() =
  handle h = Effect with
    fun foo()(r) =
      let m = r()
      print("Bye!")
      m
  in
    h.foo()
    return 3
  10

:expect 3
f()
//│ = 3

:e
let l = () =>
  handle h = Effect with
    fun foo()(r) = r(())
  return 3
  4
//│ ╔══[ERROR] Return statements are not allowed outside of a function.
//│ ║  l.39: 	  return 3
//│ ╙──      	         ^
//│ l = [function l]

:re
l()
//│ ═══[RUNTIME ERROR] Error: MLscript call unexpectedly returned `undefined`, the forbidden value.

:e
handle h1 = Effect with
  fun foo()(r) = r(())
let l = () =>
  handle h2 = Effect with
    fun bar()(r) = r(())
  h1.foo()
  return 3
  4
l()
//│ ╔══[ERROR] Return statements are not allowed outside of a function.
//│ ║  l.57: 	  return 3
//│ ╙──      	         ^


